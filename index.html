<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Pinia: State Management in Vue</title>

		<link rel="stylesheet" href="dist/reset.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/theme/white.css">
		<link rel="stylesheet" href="dist/theme/custom.css">

		<link rel="stylesheet" href="plugin/highlight/monokai.css">
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section>
					<h2>üçç Pinia üçç</h2>
					<h2>State Management in Vue</h2>
				</section>
				<section>
					<h2>Hello</h2>
					<div class="grid">
						<div style="font-size: 1.75rem; text-align: left;">
							Vanessa Otto, <a href="https://twitter.com/vannsl" target="_blank" rel="noopener">@vannsl</a>, 
							<a href="https://vannsl.io" target="_blank" rel="noopener">vannsl.io</a><br>
							Frontend Lead <a href="https://zavvy.io" target="_blank" rel="noopener">Zavvy</a>
							<hr />
							Podcasts:<br>
							<ul>
								<li><a href="https://expect-exception.fail/" target="_blank" rel="noopener">expect(Exception)</a></li>
								<li><a href="https://workingdraft.de/" target="_blank" rel="noopener">Working Draft</a></li>
							</ul>
							<hr />
							past:<br>
							<ul>
								<li>Program Committee <a href="https://js-kongress.com/" target="_blank" rel="noopener">JSKongress</a></li>
								<li>Chapter Lead <a href="https://www.vuevixens.org/" target="_blank" rel="noopener">Frontend Foxes</a></li>
							</ul>
						</div>
						<img data-src="img/vanessa_boehner.jpg">
					</div>
				</section>
				<section>
					<section>
						<h2>About today</h2>
						<ul>
							<li>Learn about the local and global state management</li>
							<li>Learn theory how to use Pinia</li>
							<li>Practice writing Pinia stores with several exercises</li>
							<li>Learn when to use Pinia, Vuex, or no library</li>
							<li>Learn how to use Dev Tools and TypeScript with Pinia</li>
							<li>Answering frequently asked questions about Pinia</li>
						</ul>
					</section>
					<section>
						<h2>One-day Workshop</h2>
						<ul>
							<li>9am Welcome</li>
							<li>12pm Lunch break</li>
							<li>3pm Coffee break</li>
							<li>4pm Closing</li>
						</ul>
					</section>
					<section>
						<h2>üîÅ Repeating structure</h2>
						<div style="text-align: left;">
							<div><strong>Theory</strong></div>
							<div style="margin-bottom: 1rem"><small>In each section we'll learn the theory for an exercise afterwards. Ask questions anytime!</small></div>
							<div><strong>Exercise</strong></div>
							<div style="margin-bottom: 1rem"><small>Find the exercises here in the slides at the end of each section.</small></div>
							<div><strong>Solution</strong></div>
							<div><small>Find the solutions to the exercises in feature branches, linked here in the slides.</small></div>
						</div>
					</section>
					<section>
						<h2>Types of exercises</h2>
						<ul>
							<li>Install and register Pinia</li>
							<li>Learn about Options and Setup Stores</li>
							<li>Create, access, and mutate state</li>
							<li>Use Actions and Getters</li>
							<li>Subscribing to changes</li>
							<li>Composing stores</li>
							<li>Migrating from Vuex to Pinia</li>
							<li>Testing stores</li>
						</ul>
					</section>
					<section>
						<h2>Questions?</h2>
					</section>
				</section>
				<section>
					<section>
						<h2>Who are we?</h2>
						<h3>Experience and Expectations</h3>
					</section>
					<section>
						<h2>Photo Time</h2>
						<p>üì∏ üì∏ üì∏</p>
					</section>
				</section>
				<section>
					<h2>Setup Check-In</h2>
					<p><a href="https://github.com/Vannsl/pinia-workshop" target="_blank" rel="noopener">https://github.com/Vannsl/pinia-workshop</a></p>
					<ul>
						<li>Git repository cloned ‚úÖ 
						<ul>
							<li>git@github.com:Vannsl/pinia-workshop.git</li>
						</ul></li>
						<li>Codebase setup ‚úÖ</li>
						</ul>
						<pre><code>$ npm install
$ yarn install
$ pnpm install

$ npm run dev
$ yarn run dev
$ pnpm run dev
</code></pre>
				</section>
				<section>
					<h2>Workshop App</h2>
					<p>
						Let's check out the app and codebase we're going to build today.
					</p>
				</section>
				<section>
					<section data-auto-animate="">
						<h2>Pinia</h2>
						<ul>
							<li>Recommended for <strong>global</strong> state management in Vue</li>
						</ul>
					</section>
					<section data-auto-animate="">
						<h2>Pinia</h2>
						<ul>
							<li>Recommended for <strong>global</strong> state management in Vue</li>
							<li>Eduardo San Martin Morote (@posva) - Vue Core Team member</li>
						</ul>
					</section>
					<section data-auto-animate="">
						<h2>Pinia</h2>
						<ul>
							<li>Recommended for <strong>global</strong> state management in Vue</li>
							<li>Eduardo San Martin Morote (@posva) - Vue Core Team member</li>
							<li>Started in Nov 2019</li>
						</ul>
					</section>
					<section data-auto-animate="">
						<h2>Pinia</h2>
						<ul>
							<li>Recommended for <strong>global</strong> state management in Vue</li>
							<li>Eduardo San Martin Morote (@posva) - Vue Core Team member</li>
							<li>Started in Nov 2019</li>
							<li>Experiment how a Store for Vue 3 with Composition API might look like</li>
						</ul>
					</section>
					<section data-auto-animate="">
						<h2>Pinia</h2>
						<ul>
							<li>Recommended for <strong>global</strong> state management in Vue</li>
							<li>Eduardo San Martin Morote (@posva) - Vue Core Team member</li>
							<li>Started in Nov 2019</li>
							<li>Experiment how a Store for Vue 3 with Composition API might look like</li>
							<li>Became the successor of Vuex 4</li>
						</ul>
					</section>
					<section data-auto-animate="">
						<h2>Vue 2</h2>
					</section>
					<section data-auto-animate="">
						<h2>Vue 2</h2>
						<p>Yes, you can use Pinia with Vue 2.</p>
					</section>
					<section data-auto-animate="">
						<h2>Vue 2</h2>
						<p>Yes, you can use Pinia with Vue 2.</p>
						<div style="text-align:left">
							<p><small>You still might want to import <code>@vue/composition-api</code>. You can access the store in <code>script setup</code> or, when using Options API, in the <code>setup()</code> function.</small></p>
							<p><small>Without Composition API, you can use <code>mapState, mapGetters, mapActions</code> helpers. It comes with some caveats.</small></p>
							<p><small>In this workshop we'll focus on Vue 3 and Composition API.</small></p>
						</div>
					</section>
					<section>
						<h2>Local state management</h2>
						<pre><code data-trim data-line-numbers class="handlebars hljs">
<script setup>
	import { ref } from "vue"

	const count = ref(0); // or reactive

	function increment() {
		count.value++;
	}
</script>

<template>
	{{ count }}
</template></code></pre>
					</section>
					<section>
						<h2><strong>One way</strong> data flow</h2>
						<figure>
							<img src="img/state-flow.png" />
							<figcaption><small>https://vuejs.org/guide/scaling-up/state-management.html#what-is-state-management</small></figcaption>
						</figure>
					</section>
					<section>
						<h2>Vue 3 APIs</h2>
						<ul>
							<li>Reactivity API</li>
							<li>Composition API</li>
						</ul>
					</section>
					<section data-auto-animate="">
						<h2>Local state management with Composables</h2>
					</section>
					<section data-auto-animate="">
						<h2>Local state management with Composables</h2>
						<pre><code data-trim data-line-numbers>// composables/useItems.ts
import { ref, readonly } from "vue";

function useItems() {
	const items = ref([]);

	async function loadItems() {
		// try catch
		items.value = fetch("/getItems");
	}

	function deleteItem(id: number) {
		items.value = items.value.filter((item) => item.id !== id);
	}

	return {
		items: readonly(items.value),
		loadItems,
		deleteItem,
	}
}
						</code></pre>
					</section>
					<section data-auto-animate="">
						<h2>Global state management with Composables</h2>
					</section>
					<section data-auto-animate="">
						<h2>Global state management with Composables</h2>
						<pre><code data-trim data-line-numbers>// composables/useItems.ts
import { ref, readonly } from "vue";
							
const items = ref([]);

function useItems() {
	async function loadItems() {
		// try catch
		items.value = fetch("/getItems");
	}

	function deleteItem(id: number) {
		items.value = items.value.filter((item) => item.id !== id);
	}

	return {
		items: readonly(items.value),
		loadItems,
		deleteItem,
	}
}
						</code></pre>
					</section>
					<section data-auto-animate="">
						<h2>Global state management with Composables</h2>
						<pre><code data-trim data-line-numbers="4">// composables/useItems.ts
import { ref, readonly } from "vue";
							
const items = ref([]);

function useItems() {
	async function loadItems() {
		// try catch
		items.value = fetch("/getItems");
	}

	function deleteItem(id: number) {
		items.value = items.value.filter((item) => item.id !== id);
	}

	return {
		items: readonly(items.value),
		loadItems,
		deleteItem,
	}
}
						</code></pre>
					</section>
					<section data-visibility="hidden">
						<h2>Stores with the provide/inject pattern</h2>
					</section>
					<section>
						<h2>Do we need a library?</h2>
					</section>
					<section data-auto-animate>
						<figure>
							<img src="img/vue-pinia.png" alt="" style="border: 1px solid black;" />
							<figcaption><small>https://vuejs.org/guide/scaling-up/state-management.html#pinia</small></figcaption>
						</figure>
					</section>
					<section data-auto-animate>
						<figure>
							<img src="img/vue-pinia-zoomed.png" alt="" style="border: 1px solid black;" />
							<figcaption><small>https://vuejs.org/guide/scaling-up/state-management.html#pinia</small></figcaption>
						</figure>
					</section>
				</section>
				<section>
					<section>
						<h2>Introduction to Pinia</h2>
					</section>
					<section data-auto-animate>
						<h2>Misconception</h2>
					</section>
					<section data-auto-animate>
						<h2>Misconception</h2>
						<p><strong>Global</strong> state management does not mean to have one big store.</p>
					</section>
					<section data-auto-animate>
						<h2>Misconception</h2>
						<p><strong>Global</strong> state management does not mean to have one big store.</p>
						<p>Pinia is modular by design: Build multiple stores and let your bundler code split them automatically.</p>
					</section>
					<section>
						<picture>
							<img src="img/pinia-global.png" alt="" style="max-height: 40vh;" />
							<figcaption><small>Several components getting data from several stores</small></figcaption>
						</picture>
					</section>
					<section data-auto-animate>
						<h2>Structure</h2>
						<ul>
							<li><code>/src/stores/useStore.[js|ts]</code></li>
							<li><code>/src/stores/useTodoListStore.[js|ts]</code></li>
							<li><code>/src/stores/useCartStore.[js|ts]</code></li>
							<li><code>/src/stores/useAuthenticationStore.[js|ts]</code></li>
						</ul>
					</section>
					<section data-auto-animate>
						<h2>Structure</h2>
						<ul>
							<li><code>/src/stores/useStore.[js|ts]</code></li>
							<li style="opacity: 0.3"><code>/src/stores/useTodoListStore.[js|ts]</code></li>
							<li style="opacity: 0.3"><code>/src/stores/useCartStore.[js|ts]</code></li>
							<li style="opacity: 0.3"><code>/src/stores/useAuthenticationStore.[js|ts]</code></li>
						</ul>
					</section>
					<section data-auto-animate>
						<h2>Structure</h2>
						<ul>
							<li style="opacity: 0.3"><code>/src/stores/useStore.[js|ts]</code></li>
							<li><code>/src/stores/useTodoListStore.[js|ts]</code></li>
							<li><code>/src/stores/useCartStore.[js|ts]</code></li>
							<li><code>/src/stores/useAuthenticationStore.[js|ts]</code></li>
						</ul>
					</section>
					<section>
						<h2>Installation</h2>
						<pre><code>$ npm install pinia
$ yarn add pinia
$ pnpm install pinia
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Registration</h2>
						<pre><code data-trim data-line-numbers>
// main.[js,ts]
import { createApp } from "vue";
import App from "./App.vue";
import { createPinia } from "pinia";
	
createApp(App)
	.use(createPinia())
	.mount("#app");
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Registration</h2>
						<pre><code data-trim data-line-numbers="4,7">
// main.[js,ts]
import { createApp } from "vue";
import App from "./App.vue";
import { createPinia } from "pinia";
	
createApp(App)
	.use(createPinia())
	.mount("#app");
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Creating a store</h2>
						<pre><code data-trim data-line-numbers>
// stores/useCartStore.[js,ts]
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", {
  // ...
})
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Creating a store</h2>
						<pre><code data-trim data-line-numbers="2">
// stores/useCartStore.[js,ts]
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", {
  // ...
})
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Creating a store</h2>
						<pre><code data-trim data-line-numbers="4-6">
// stores/useCartStore.[js,ts]
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", {
  // ...
})
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Creating a store</h2>
						<!-- TODO: replace image -->
						<img src="img/product-store.png">
						<p><small>This <em>name</em>, also referred as id, is necessary and is used by Pinia to connect the store to the devtools. Naming the returned function use... is a convention across composables to make its usage idiomatic.
						</small></p>
					</section>
					<section>
						<h2>Exercise A</h2>
						<small style="text-align: left;">
							<ol>
								<li>
									Install the pinia library
								</li>
								<li>
									Register pinia when creating the Vue application
								</li>
								<li>
									Create your first <code>store</code> called <code>useStatisticStore</code>
								</li>
								<li>
									Import the <code>useStatisticStore</code> in <code>AnalyticsStats.vue</code>
								</li>
								<li>
									Check your Dev Tools if you can see the Pinia store
								</li>
							</ol>
							<p><i>Hint: Don't add any data yet. The store should be empty. We will move the data in the next exercise.</i></p>
						</small>
					</section>
					<section>
						<h2>Solution A</h2>
						Branchname: <code>A-statistics-store</code>
					</section>
				</section>
				<section>
					<section data-auto-animate="">
						<h2>Concepts</h2>
					</section>
					<section data-auto-animate="">
						<h2>Concepts</h2>
						<ul>
							<li>State</li>
							<li>Getters</li>
							<li>Actions</li>
						</ul>
					</section>
					<section data-auto-animate="">
						<h2>Concepts</h2>
						<ul>
							<li>State</li>
							<li>Getters</li>
							<li>Actions</li>
							<li><s style="opacity: 0.5;">Mutations</s></li>
						</ul>
					</section>
					<section>
						<h2>Store Variants</h2>
						<ul>
							<li>
								Option Store
							</li>
							<li>
								Setup Store
							</li>
						</ul>
					</section>
					<section>
						<h2>Store Variants</h2>
						<p>You can chose the variant you feel the most comfortable with. In doubt, try the Options Store first.</p>
					</section>
					<section>
						<h2>Store Variants</h2>
						<p>Setup stores can bring more flexibility, but also more complexity.</p>
					</section>
					<section data-auto-animate>
						<h2>State: Option Store</h2>
						<pre><code data-trim data-line-numbers="" class="hljs javascript">
// stores/useCartStore.[js,ts]
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", {
  state: () => ({}),
	getters: {},
	actions: {},
})
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>State: Option Store</h2>
						<pre><code data-trim data-line-numbers="5" class="hljs javascript">
// stores/useCartStore.[js,ts]
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", {
	state: () => ({}),
	getters: {},
	actions: {},
})
</code></pre>
<p><small>The state is defined as a function that returns the initial state. This allows Pinia to work in both Server and Client Side.</small></p>
					</section>
					<section data-auto-animate>
						<h2>State: Option Store</h2>
						<pre><code data-trim data-line-numbers="5-9" class="hljs javascript">
// stores/useCartStore.[js,ts]
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", {
	state: () => {
		return {
			items: [],
			shippingPrice: 0,
		}
	},
	getters: {},
	actions: {},
})
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>State: Option Store</h2>
						<p>TypeScript using <code>as</code></p>
						<pre><code data-trim data-line-numbers="5-9" class="hljs javascript">
// stores/useCartStore.ts
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", {
	state: () => {
		return {
			items: [] as Item[],
			shippingPrice: 0 as number,
		}
	},
	getters: {},
	actions: {},
})
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>State: Option Store</h2>
						<p>TypeScript using <code>return type</code> for <code>state</code></p>
						<pre><code data-trim data-line-numbers="4-7,10-15" class="hljs typescript">
// stores/useCartStore.ts
import { defineStore } from "pinia";

type RootState = {
	items: Item[],
	shippingPrice: number,
};
	
export const useCartStore = defineStore("Cart", {
	state: (): RootState => {
		return {
			items: [],
			shippingPrice: 0,
		}
	},
	getters: {},
	actions: {},
})
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>State: Setup Store</h2>
						<pre><code data-trim data-line-numbers="2,6,7,12-14" class="hljs javascript">
// stores/useCartStore.[js,ts]
import { ref } from "vue";
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", () => {
	const items = ref([]);
	const shippingPrice = ref(0);

	// getters
	// actions

	return {
		items,
		shippingPrice,
	}
})
</code></pre>
				</section>
					<section data-auto-animate>
						<h2>State: Setup Store</h2>
						<p>TypeScript</p>
						<pre><code data-trim data-line-numbers="4,7,8" class="hljs typescript">
// stores/useCartStore.ts
import { ref } from "vue";
import { defineStore } from "pinia";
import type { CartItem } from "@/types/CartItem"
	
export const useCartStore = defineStore("Cart", () => {
	const items = ref<CartItem[]>([]); // needs a custom type
	const shippingPrice = ref(0); // is automatically number

	// getters
	// actions

	return {
		items,
		shippingPrice,
	}
})
</code></pre>
				</section>
				<section data-auto-animate>
					<h2>Accessing the state</h2>
				</section>
				<section data-auto-animate>
					<h2>Accessing the state</h2>
					<p>The following examples work for both, Options and Setup Store</p>
				</section>
					<section data-auto-animate>
						<h2>Accessing the state</h2>
						<pre><code data-trim data-line-numbers="2,4" class="hljs handlebars">
<script setup>
import { useCartStore } from "@/stores/useCartStore";

const cartStore = useCartStore();

console.log(cartStore.$state.items);
console.log(cartStore.items);
</script>
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Accessing the state</h2>
						<pre><code data-trim data-line-numbers="6" class="hljs handlebars">
<script setup>
import { useCartStore } from "@/stores/useCartStore";

const cartStore = useCartStore();

console.log(cartStore.$state.items);
console.log(cartStore.items);
</script>
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Accessing the state</h2>
						<pre><code data-trim data-line-numbers="7" class="hljs handlebars">
<script setup>
import { useCartStore } from "@/stores/useCartStore";

const cartStore = useCartStore();

console.log(cartStore.$state.items);
console.log(cartStore.items); // Pinia magic!
</script>
</code></pre>
				</section>
					<section data-auto-animate>
						<h2>Accessing the state</h2>
						<code>storeToRefs</code>
						<pre><code data-trim data-line-numbers="" class="hljs handlebars">
<script setup>
import { storeToRefs } from "pinia";
import { useCartStore } from "@/stores/useCartStore";

const cartStore = useCartStore();
const { items } = storeToRefs(cartStore);

console.log(items.value);
</script>
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Accessing the state</h2>
						<code>storeToRefs</code>
						<pre><code data-trim data-line-numbers="2,6,8" class="hljs handlebars">
<script setup>
import { storeToRefs } from "pinia";
import { useCartStore } from "@/stores/useCartStore";

const cartStore = useCartStore();
const { items } = storeToRefs(cartStore);

console.log(items.value);
</script>
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Accessing the state</h2>
						<code>storeToRefs</code>
						<pre><code data-trim data-line-numbers="2,6,8" class="hljs handlebars">
<script setup>
import { storeToRefs } from "pinia";
import { useCartStore } from "@/stores/useCartStore";

const cartStore = useCartStore();
const { items } = storeToRefs(cartStore);

console.log(items.value);
</script>
</code></pre>
<p><small>Works with state and getters. Not with actions.</small></p>
					</section>
					<section data-auto-animate>
						<h2>Accessing the state</h2>
						<code>storeToRefs</code>
						<pre><code data-trim data-line-numbers="2,6,8" class="hljs handlebars">
<script setup>
import { storeToRefs } from "pinia";
import { useCartStore } from "@/stores/useCartStore";

const cartStore = useCartStore();
const { items } = storeToRefs(cartStore);

console.log(items.value);
</script>
</code></pre>
<p><small>Works with state and getters. Not with actions.</small></p>
<p><small>Helpful, when you only need state and getters.</small></p>
					</section>
					<section data-auto-animate>
						<h2>Accessing the state</h2>
						<code>storeToRefs</code>
						<pre><code data-trim data-line-numbers="5" class="hljs handlebars">
<script setup>
import { storeToRefs } from "pinia";
import { useCartStore } from "@/stores/useCartStore";

const { items } = storeToRefs(useCartStore());

console.log(items.value);
</script>
</code></pre>
					</section>
					<section data-auto-animate data-visibility="hidden">
						<h2>Accessing the state</h2>
						<code>Copy</code>
						<!-- TODO: Test if it works -->
						<pre><code data-trim data-line-numbers="1,5" class="hljs handlebars">
<script setup>
import { toRef } from "vue";
import { useCartStore } from "@/stores/useCartStore";

const store = useCartStore();
const items = toRef(store, "items");

console.log(items.value);
</script>
</code></pre>
					</section>
					<section>
						<h2>HMR Update</h2>
						<pre><code data-trim data-line-numbers="1,4-7" class="hljs javascript">
import { acceptHMRUpdate, defineStore } from "pinia";

export const useCartStore = defineStore("CartStore", {});

if (import.meta.hot) {
	import.meta.hot.accept(acceptHMRUpdate(useProductStore, import.meta.hot));
}							
</code></pre>
					</section>
					<section>
						<h2>Exercise B</h2>
						<small style="text-align: left;">
							<ol>
								<li>
									Decide for Option Store or Setup Store
								</li>
								<li>
									Move the <code>stats.json</code> to the <code>state</code> of the <code>useStatisticStore</code>
								</li>
								<li>
									Change the <code>stats values</code> using the Vue Dev Tools
								</li>
								<li>
									Bonus A: Use TypeScript to add a type to the state
								</li>
								<li>
									Bonus B: Implement both versions, Option and Setup Store
								</li>
							</ol>
						</small>
					</section>
					<section>
						<h2>Solution B</h2>
						Branchname: <code>B-statistics-state</code>
					</section>
				</section>
				<section>
					<section data-auto-animate>
						<h2>Mutating the state</h2>
						<ul>
							<li>Directly</li>
							<li>Patching (Object)</li>
							<li>Patching (Function)</li>
						</ul>
					</section>
					<section data-auto-animate>
						<h2>Mutating the state</h2>
						<ul>
							<li><strong>Directly</strong></li>
							<li>Patching (Object)</li>
							<li>Patching (Function)</li>
						</ul>
					</section>
					<section data-auto-animate>
						<h2>Mutating the state</h2>
						<ul>
							<li><strong>Directly</strong></li>
							<li>Patching (Object)</li>
							<li>Patching (Function)</li>
						</ul>
						<pre><code data-trim data-line-numbers class="hljs handlebars">
							<script setup>
								// ...
								cartStore.items = [];
								cartStore.shippingPrice = 0;		
								// ...
							</script>
						</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Mutating the state</h2>
						<ul>
							<li><strong>Directly</strong></li>
							<li>Patching (Object)</li>
							<li>Patching (Function)</li>
						</ul>
						<pre><code data-trim data-line-numbers class="hljs handlebars">
							<template>
								<input v-model="cartStore.shippingPrice" type="number">		
							</template>		
						</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Mutating the state</h2>
						<ul>
							<li>Directly</li>
							<li><strong>Patch (Object)</strong></li>
							<li>Patching (Function)</li>
						</ul>
						<pre><code data-trim data-line-numbers>
cartStore.$patch({ items: [], shippingPrice: 0 })				
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Mutating the state</h2>
						<ul>
							<li>Directly</li>
							<li><strong>Patch (Object)</strong></li>
							<li>Patching (Function)</li>
						</ul>
						<pre><code data-trim data-line-numbers class="hljs javascript">
cartStore.$patch({ items: [], shippingPrice: 0 })				
</code></pre>
						<p><small>Use <code>$patch</code> to apply multiple changes together passing a partial <code>state</code> object.</small></p>
					</section>
					<section data-auto-animate>
						<h2>Mutating the state</h2>
						<ul>
							<li>Directly</li>
							<li><strong>Patch (Object)</strong></li>
							<li>Patching (Function)</li>
						</ul>
						<pre><code data-trim data-line-numbers class="hljs javascript">
cartStore.$patch({ items: [], shippingPrice: 0 })				
</code></pre>
						<p><small>Use <code>$patch</code> to apply multiple changes together passing a partial <code>state</code> object.</small></p>
						<p><small>The Vue Dev Tools will show the mutations as a group.</small></p>
					</section>
					<section data-auto-animate>
						<h2>Mutating the state</h2>
						<ul>
							<li>Directly</li>
							<li>Patching (Object)</li>
							<li><strong>Patch (Function)</strong></li>
						</ul>
						<pre><code data-trim data-line-numbers>
							cartStore.$patch((state) => {
								state.items.push({ name: "shirt", price: 26, amount: 1 });
								state.shippingPrice = 5;
							})					
							</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Mutating the state</h2>
						<ul>
							<li>Directly</li>
							<li>Patching (Object)</li>
							<li><strong>Patch (Function)</strong></li>
						</ul>
						<pre><code data-trim data-line-numbers>
							cartStore.$patch((state) => {
								state.items.push({ name: "shirt", price: 26, amount: 1 });
								state.shippingPrice = 5;
							})					
							</code></pre>
							<p><small>Sometimes, it can be hard to express a mutation in object syntax. You can pass a function instead. E.g. for pushing items to an array.</small></p>
					</section>
					<section data-auto-animate>
						<h2>Mutating the state</h2>
							<p>‚ùå Replacing</p>
							<pre><code data-trim data-line-numbers>
cartStore.$state = { items: [] };
</code></pre>
						<p><small>Replacing state like this would break reactivity. Instead, use <code>$patch</code>.</small></p>
					</section>
					<section data-auto-animate>
						<h2>Mutating the state</h2>
							<p>‚ùå Replacing</p>
							<pre><code data-trim data-line-numbers>
cartStore.$state = { items: [] };
</code></pre>
						<p><small>Replacing state like this would break reactivity. Instead, use <code>$patch</code>.</small></p>
						<p>‚úÖ Replacing</p>
						<pre><code data-trim data-line-numbers class="hljs javascript">
cartStore.$patch({ items: [] })				
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Mutating the state</h2>
						<p>Initialization</p>
							<pre><code data-trim data-line-numbers>
								pinia.state.value = JSON.parse(window.__pinia)		
</code></pre>
<p><small>You can set the initial state, helpful e.g. in tests or for SSR.</small></p>
					</section>
					<section>
						<h2>Resetting the state</h2>
						<p>Resets the state of <strong>exactly this store</strong>.</p>
							<pre><code data-trim data-line-numbers>
const cartStore = useCartStore();

cartStore.$reset();
</code></pre>
					</section>
					<section>
						<h2>Exercise C: Mutate the state</h2>
						<small style="text-align: left;">
							<ol>
								<li>Create the store <code>useColorSchemeStore</code>.</li>
								<li>Add state variable <code>currentColorSchemeSlug</code>.</li>
								<li>Set the default of the variable to <code>"light"</code>.</li>
								<li>Update the variable when interacting with the radio buttons using a <code>v-model</code>.</li>
								<li>Add or remove the CSS class <code>dark</code> on the <code>html</code> attribute depending on the value of  <code>currentColorSchemeSlug</code>.</li>
								<li>Bonus 1: Implement alternative solution using <code>$patch</code> to update the state.</li>
								<li>
									Bonus 2: Sync the pinia store with the Local Storage (Tip: <a href="https://vueuse.org/core/useStorage/" target="_blank" rel="noopener">@vueuse/core</a>)
								</li>
							</ol>
						</small>
					</section>
					<section>
						<h2>Solution C</h2>
						Branchname: <code>C-mutating-state</code>
					</section>
				</section>
				<section>
					<section data-auto-animate="">
						<h2>Actions</h2>
					</section>
					<section data-auto-animate="">
						<h2>Actions</h2>
						<ul>
							<li>Actions are the equivalent of <code>methods</code> in components.</li>
						</ul>
					</section>
					<section data-auto-animate="">
						<h2>Actions</h2>
						<ul>
							<!-- TODO: can you? -->
							<li>Actions are the equivalent of <code>methods</code> in components.</li>
							<li>You can call other actions of the same (and other) stores in your action.</li>
						</ul>
					</section>
					<section data-auto-animate="">
						<h2>Actions</h2>
						<ul>
							<li>Actions are the equivalent of <code>methods</code> in components.</li>
							<li>You can call other actions of the same (and other) stores in your action.</li>
							<li>They can be defined with the <code>actions</code> property in <code>defineStore()</code> in an Option Store.</li>
						</ul>
					</section>
					<section data-auto-animate="">
						<h2>Actions</h2>
						<ul>
							<li>Actions are the equivalent of <code>methods</code> in components.</li>
							<li>You can call other actions of the same (and other) stores in your action.</li>
							<li>They can be defined with the <code>actions</code> property in <code>defineStore()</code> in an Option Store.</li>
							<li>Or as normal functions on a Setup Store.</li>
						</ul>
					</section>
					<section data-auto-animate="">
						<h2>Actions</h2>
						<ul>
							<li>Actions are the equivalent of <code>methods</code> in components.</li>
							<li>You can call other actions of the same (and other) stores in your action.</li>
							<li>They can be defined with the <code>actions</code> property in <code>defineStore()</code> in an Option Store.</li>
							<li>Or as normal functions on a Setup Store.</li>
							<li>They are <strong>perfect to define business logic</strong>.</li>
						</ul>
					</section>
					<section data-auto-animate="">
						<h2>Actions: Option Store</h2>
					</section>
					<section data-auto-animate="">
						<h2>Actions: Option Store</h2>
						<pre><code data-trim data-line-numbers="" class="hljs javascript">
// stores/useCartStore.[js,ts]
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", {
	state: () => {
		return {
			items: [],
			shippingPrice: 0,
		}
	},
	actions: {
		addItem(item) {
			this.items.push(item);
		},
		removeItem(id) {
			this.items = this.items.filter((item) => item.id !== id);
		},
	},
})
</code></pre>
					</section>
					<section data-auto-animate="">
						<h2>Actions: Option Store</h2>
						<pre><code data-trim data-line-numbers="12-17" class="hljs javascript">
// stores/useCartStore.[js,ts]
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", {
	state: () => {
		return {
			items: [],
			shippingPrice: 0,
		}
	},
	actions: {
		addItem(item) {
			this.items.push(item);
		},
		removeItem(id) {
			this.items = this.items.filter((item) => item.id !== id);
		},
	},
})
</code></pre>
					</section>
					<section data-auto-animate="">
						<h2>Actions: Option Store</h2>
						<pre><code data-trim data-line-numbers="12-19" class="hljs javascript">
// stores/useCartStore.[js,ts]
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", {
	state: () => {
		return {
			items: [],
			shippingPrice: 0,
		}
	},
	actions: {
		// ‚ùå No access to `this` using arrow functions:
		addItem: (item) =>  {
			this.items.push(item);
		},
		// ‚úÖ Access to `this`, use this syntax:
		removeItem(id) {
			this.items = this.items.filter((item) => item.id !== id);
		},
	},
})
</code></pre>
					</section>
					<section data-auto-animate="">
						<h2>Actions: Option Store <em>Patch</em></h2>
						<pre><code data-trim data-line-numbers="12-16" class="hljs javascript">
// stores/useCartStore.[js,ts]
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", {
	state: () => {
		return {
			items: [],
			shippingPrice: 0,
		}
	},
	actions: {
		addItem(item) {
			this.$patch((state) => {
				state.items.push(item)
			})
		},
		removeItem(id) {
			this.items = this.items.filter((item) => item.id !== id);
		},
	},
})
</code></pre>
					</section>
					<section data-auto-animate="">
						<h2>Actions: Option Store <em>Async</em></h2>
						<pre><code data-trim data-line-numbers="12-15" class="hljs javascript">
// stores/useCartStore.[js,ts]
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", {
	state: () => {
		return {
			items: [],
			shippingPrice: 0,
		}
	},
	actions: {
		async loadItems() {
			const result = await fetch("/cart-endpoint");
			this.items = await result.json();
		},
		addItem(item) {
			this.items.push(item);
		},
		removeItem(id) {
			this.items = this.items.filter((item) => item.id !== id);
		},
	},
})
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Actions: Setup Store</h2>
						</section>
					<section data-auto-animate>
						<h2>Actions: Setup Store</h2>
						<pre><code data-trim data-line-numbers="" class="hljs javascript">
// stores/useCartStore.[js,ts]
import { ref } from "vue";
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", () => {
	// state
	const items = ref([]);
	const shippingPrice = ref(0);

	// actions
	async function loadItems() {
		const result = await fetch("/cart-endpoint");
		this.items = await result.json();
	}
	function addItem(item) {
		items.value.push(item);
	}
	function removeItem(id) {
		items.value = items.value.filter((item) => item.id !== id);
	}

	return {
		items,
		shippingPrice,
		loadItems,
		addItem,
		removeItem,
	}
})
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Actions: Setup Store</h2>
						<pre><code data-trim data-line-numbers="11-20,25-27" class="hljs javascript">
// stores/useCartStore.[js,ts]
import { ref } from "vue";
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", () => {
	// state
	const items = ref([]);
	const shippingPrice = ref(0);

	// actions
	async function loadItems() {
		const result = await fetch("/cart-endpoint");
		this.items = await result.json();
	}
	function addItem(item) {
		items.value.push(item);
	}
	function removeItem(id) {
		items.value = items.value.filter((item) => item.id !== id);
	}

	return {
		items,
		shippingPrice,
		loadItems,
		addItem,
		removeItem,
	}
})
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Accessing actions</h2>
						<!-- TODO: test if this works -->
						<pre><code data-trim data-line-numbers="" class="hljs">
<script setup>
	import { useCartStore } from "@/stores/useCartStore.js";

	const cartStore = useCartStore();
	
	await cartStore.loadItems();
</script>
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Accessing actions</h2>
						<p>Destructure <strong>without</strong> <code>storeToRefs()</code></p>
						<pre><code data-trim data-line-numbers="" class="hljs">
<script setup>
	import { storeToRefs } from "pinia";
	import { useCartStore } from "@/stores/useCartStore.js";

	const cartStore = useCartStore();
	const { loadItems } = storeToRefs(cartStore); ‚ùå
	
	await loadItems();
</script>
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Accessing actions</h2>
						<p>Destructure <strong>without</strong> <code>storeToRefs()</code></p>
						<pre><code data-trim data-line-numbers="" class="hljs">
<script setup>
	import { useCartStore } from "@/stores/useCartStore.js";

	const { loadItems } = useCartStore();
	
	await loadItems();
</script>
</code></pre>
					</section>
					<section>
						Q: When to use <code>actions</code> vs. <code>direct mutation</code>?
					</section>
					<section>
						<h2>Exercise D</h2>
						<ol style="font-size: 2rem;">
							<li>Create the store <code>useTodoListStore</code></li>
							<li>Import the store in <code>TodoList.vue</code></li>
							<li>Move the state of <code>@/data/todoItems.json</code> into the store and use the state in the Component</li>
							<li>Create action(s) to change the <strong>completeness</strong> state of an item.</li>
							<li>Create action(s) to change the <strong>archived</strong> state of an item.</li>
							<li>Create an action to <strong>add</strong> a new item.</li>
							<li>Hint You can use <code>this.todoItems.length + 1</code> as ID for added items</li>
						</ol>
					</section>
					<section>
						<h2>Exercise D</h2>
						<strong>Bonus:</strong>
						<ol style="font-size: 2rem;">
							<li>Create an action in <code>useColorSchemeStore</code> to update the state variable. This replaces the direct mutation using the <code>v-model</code></li>
							<li>Update the LocalStorage in the store action.</li>
							<li>Call the action in the component.</li>
							<li>Hint: It might be useful <strong>copy</strong> the store variable <code>currentColorSchemeslug</code> first.</li>
						</ol>
					</section>
					<section>
						<h2>Solution D</h2>
						Branchname: <code>D-state-actions</code>
					</section>
				</section>
				<section>
					<section data-auto-animate="">
						<h2>Getters</h2>
					</section>
					<section data-auto-animate="">
						<h2>Getters</h2>
						<ul>
							<li>Getters are the equivalent of <code>computed properties</code>.</li>
						</ul>
					</section>
					<section data-auto-animate="">
						<h2>Getters</h2>
						<ul>
							<li>Getters are the equivalent of <code>computed properties</code>.</li>
							<li>Pinia caches the value as long as it does not change.</li>
						</ul>
					</section>
					<section data-auto-animate="">
						<h2>Getters: Option Store</h2>
					</section>
					<section data-auto-animate="">
						<h2>Getters: Option Store</h2>
						<pre><code data-trim data-line-numbers="">
// stores/useCartStore.[js,ts] 
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", {
	state: () => {
		return {
			items: [],
			shippingPrice: 0,
		}
	},
	getters: {
    totalPrice: (state) =>
      state.items.reduce((acc, item) => item.quantity * item.price + acc, 0),
	},
	actions: {
		addItem(item) {
			this.items.push(item);
		},
		removeItem(id) {
			this.items = this.items.filter((item) => item.id !== id);
		},
	},
})
</code></pre>
					</section>
					<section data-auto-animate="">
						<h2>Getters: Option Store</h2>
						<pre><code data-trim data-line-numbers="12-14">
// stores/useCartStore.[js,ts]
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", {
	state: () => {
		return {
			items: [],
			shippingPrice: 0,
		}
	},
	getters: {
    totalPrice(state) {
      return state.items.reduce((acc, item) => item.quantity * item.price + acc, 0);
		},
	},
	actions: {
		addItem(item) {
			this.items.push(item);
		},
		removeItem(id) {
			this.items = this.items.filter((item) => item.id !== id);
		},
	},
})
</code></pre>
					</section>
					<section data-auto-animate="">
						<h2>Getters: Option Store</h2>
						<pre><code data-trim data-line-numbers="12-13">
// stores/useCartStore.[js,ts]
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", {
	state: () => {
		return {
			items: [],
			shippingPrice: 0,
		}
	},
	getters: {
    totalPrice: (state) =>
      state.items.reduce((acc, item) => item.quantity * item.price + acc, 0),
	},
	actions: {
		addItem(item) {
			this.items.push(item);
		},
		removeItem(id) {
			this.items = this.items.filter((item) => item.id !== id);
		},
	},
})
</code></pre>
					</section>
					<section data-auto-animate="">
						<h2>Getters: Option Store</h2>
						<p>Using getters in getters: JavaScript</p>
						<pre><code data-trim data-line-numbers="12-17">
// stores/useCartStore.js
import { defineStore } from "pinia";

export const useCartStore = defineStore("Cart", {
  state: () => {
    return {
			items: [],
			shippingPrice: 0,
    };
  },
  getters: {
    totalPrice: (state) =>
      state.items.reduce((acc, item) => item.quantity * item.price + acc, 0),
		// as in actions, don't use arrow function to access `this`
    totalPriceWithShipping() {
      return this.totalPrice + this.shippingPrice;
    },
  },
  actions: {
    addItem(item) {
      this.items.push(item);
    },
    removeItem(id) {
      this.items = this.items.filter((item) => item.id !== id);
    },
  },
});

</code></pre>
					</section>
					<section data-auto-animate="">
						<h2>Getters: Option Store</h2>
						<p>Using getters in getters: TypeScript</p>
						<pre><code data-trim data-line-numbers="25-28" class="hljs javascript">
// stores/useCartStore.ts
import { defineStore } from "pinia";

type Item = {
	id: number;
  quantity: number;
  price: number;
};

type RootState = {
  items: Item[];
  shippingPrice: number;
};

export const useCartStore = defineStore("Cart", {
  state: (): RootState => {
    return {
			items: [],
			shippingPrice: 0,
    };
  },
  getters: {
    totalPrice: (state) =>
      state.items.reduce((acc, item) => item.quantity * item.price + acc, 0),
		// Add return value in TypeScript
    totalPriceWithShipping(): number {
      return this.totalPrice + this.shippingPrice;
    },
  },
  actions: {
    addItem(item: Item) {
      this.items.push(item);
    },
    removeItem(id: Item["id"]) {
      this.items = this.items.filter((item) => item.id !== id);
    },
  },
});
</code></pre>
					</section>
					<section data-auto-animate="">
						<h2>Getters: Option Store</h2>
						<p>Using getters in getters: TypeScript</p>
						<pre><code data-trim data-line-numbers="25-28" class="hljs javascript">
// stores/useCartStore.ts
import { defineStore } from "pinia";

type Item = {
	id: number;
  quantity: number;
  price: number;
};

type RootState = {
  items: Item[];
  shippingPrice: number;
};

export const useCartStore = defineStore("Cart", {
  state: (): RootState => {
    return {
			items: [],
			shippingPrice: 0,
    };
  },
  getters: {
    totalPrice: (state) =>
      state.items.reduce((acc, item) => item.quantity * item.price + acc, 0),
		// Getter function can still accept `state`
    totalPriceWithShipping(state): number {
      return this.totalPrice + state.shippingPrice;
    },
  },
  actions: {
    addItem(item: Item) {
      this.items.push(item);
    },
    removeItem(id: Item["id"]) {
      this.items = this.items.filter((item) => item.id !== id);
    },
  },
});
</code></pre>
					</section>
					<section data-auto-animate="">
						<h2>Getters: Option Store</h2>
						<p>Using getters with parameters</p>
						<pre><code data-trim data-line-numbers="25-26" class="hljs javascript">
// stores/useCartStore.ts
import { defineStore } from "pinia";

type Item = {
	id: number;
  quantity: number;
  price: number;
};

type RootState = {
  items: Item[];
  shippingPrice: number;
};

export const useCartStore = defineStore("Cart", {
  state: (): RootState => {
    return {
			items: [],
			shippingPrice: 0,
    };
  },
  getters: {
    totalPrice: (state) =>
      state.items.reduce((acc, item) => item.quantity * item.price + acc, 0),
		// This syntax wil also work, but your IDE will mark it as an error:
    totalPriceWithShipping: (state) => state.totalPrice + state.shippingPrice,
  },
  actions: {
    addItem(item: Item) {
      this.items.push(item);
    },
    removeItem(id: Item["id"]) {
      this.items = this.items.filter((item) => item.id !== id);
    },
  },
});
</code></pre>
					</section>
					<section data-auto-animate="">
						<h2>Getters: Option Store</h2>
						<p>Using getters with parameters</p>
						<pre><code data-trim data-line-numbers="28" class="hljs javascript">
// stores/useCartStore.ts
import { defineStore } from "pinia";

type Item = {
	id: number;
  quantity: number;
  price: number;
};

type RootState = {
  items: Item[];
  shippingPrice: number;
};

export const useCartStore = defineStore("Cart", {
  state: (): RootState => {
    return {
			items: [],
			shippingPrice: 0,
    };
  },
  getters: {
    totalPrice: (state) =>
      state.items.reduce((acc, item) => item.quantity * item.price + acc, 0),
    totalPriceWithShipping(state): number {
      return this.totalPrice + state.shippingPrice;
    },
		getItem: (state) => (id) => state.items.find((item) => item.id === id);
  },
  actions: {
    addItem(item: Item) {
      this.items.push(item);
    },
    removeItem(id: Item["id"]) {
      this.items = this.items.filter((item) => item.id !== id);
    },
  },
});
</code></pre>
					</section>
					<section>
						<h2>Using getters with parameters</h2>
						<p>Note that when doing this, getters are not cached anymore, they are simply functions that you invoke.</p>
					</section>
					<section data-auto-animate>
						<h2>Getters: Setup Store</h2>
						<pre><code data-trim data-line-numbers="" class="hljs javascript">
// stores/useCartStore.[js,ts]
import { computed, ref } from "vue";
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", () => {
	// state
	const items = ref([]);
	const shippingPrice = ref(0);

	// getters
	const totalPrice = computed(() => items.value.reduce((acc, item) => item.quantity * item.price + acc, 0));
	const totalPriceWithShipping = computed(() => totalPrice.value + shippingPrice.value);
	const getItem = (id) => items.value.find((item) => item.id === id)

	// actions
	async function loadItems() {
		const result = await fetch("/cart-endpoint");
		this.items = await result.json();
	}
	function addItem(item) {
		items.value.push(item);
	}
	function removeItem(id) {
		items.value = items.value.filter((item) => item.id !== id);
	}

	return {
		items,
		totalPrice,
		totalPriceWithShipping,
		getItem,
		loadItems,
		addItem,
		removeItem,
	}
})
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Getters: Setup Store</h2>
						<pre><code data-trim data-line-numbers="11,12,13,25-27" class="hljs javascript">
// stores/useCartStore.[js,ts]
import { computed, ref } from "vue";
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", () => {
	// state
	const items = ref([]);
	const shippingPrice = ref(0);

	// getters
	const totalPrice = computed(() => items.value.reduce((acc, item) => item.quantity * item.price + acc, 0));
	const totalPriceWithShipping = computed(() => totalPrice.value + shippingPrice.value);
	const getItem = (id) => items.value.find((item) => item.id === id)

	// actions
	async function loadItems() {
		const result = await fetch("/cart-endpoint");
		this.items = await result.json();
	}
	function addItem(item) {
		items.value.push(item);
	}
	function removeItem(id) {
		items.value = items.value.filter((item) => item.id !== id);
	}

	return {
		items,
		totalPrice,
		totalPriceWithShipping,
		getItem,
		loadItems,
		addItem,
		removeItem,
	}
})
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Accessing getters</h2>
						<pre><code data-trim data-line-numbers="" class="hljs">
<script setup>
	import { useCartStore } from "@/stores/useCartStore.js";

	const cartStore = useCartStore();
	console.log(cartStore.totalPrice);
	console.log(cartStore.totalPriceWithShipping);
</script>
</code></pre>
					</section>
					<section data-auto-animate>
						<h2>Accessing getters</h2>
						<!-- TODO Check this -->
						<p>Destructure with <code>storeToRefs</code> will make getters reactive again</p>
						<pre><code data-trim data-line-numbers="" class="hljs">
<script setup>
	import { storeToRefs } from "pinia";
	import { useCartStore } from "@/stores/useCartStore.js";

	const cartStore = useCartStore();
	const { totalPrice, totalPriceWithShipping } = storeToRefs(cartStore);

	console.log(totalPrice.value);
	console.log(totalPriceWithShipping.value);
</script>
</code></pre>
					</section>
					<section>
						Q: When to use <code>getters</code> instead of the <code>state</code>?
					</section>
					<section>
						Q: When to use <code>getters</code> vs. <code>computed props</code>?
					</section>
					<section>
						<h2>Exercise E: Getters</h2>
						<ol>
							<li>
								Move the <code>computed properties</code> of <code>TodoList.vue</code> into the store as <code>getters</code>.
							</li>
							<li>
								Create a getter which returns the amount of active, but incomplete items.
							</li>
							<li>
								Import the store now also in <code>SideNavigation.vue</code>.
							</li>
							<li>
								Replace the hardcoded number next to "TodoList" of <code>SideNavigation.vue</code> with the getter.
							</li>
							<li>Challenge: Use a nested getter for the count of active, but incomplete items.</li>
						</ol>
					</section>
					<section>
						<h2>Solution E</h2>
						Branchname: <code>exercises/E</code>
					</section>
				</section>
				<section>
					<section data-auto-animate="">
						<h2>Composing Stores</h2>
					</section>
					<section data-auto-animate="">
						<h2>Composing Stores</h2>
						<pre><code data-trim data-line-numbers="5">
// stores/useColorSchemeStore.[js,ts]
export const useColorSchemeStore = defineStore("ColorScheme", {
	state: (): RootState => {
		return {
			currentColorSchemeSlug: useStorage(storageKey, "light"),
		};
	},
});
</code></pre>
					</section>
					<section data-auto-animate="">
						<h2>Composing Stores: Options Store</h2>
						<pre><code data-trim data-line-numbers="4,32-39">
// stores/useCartStore.[js,ts]
import { defineStore } from "pinia";

const user = useUserStore();
	
export const useCartStore = defineStore("Cart", {
	state: () => {
		return {
			items: [],
			shippingPrice: 0,
		}
	},
	getters: {
    totalPrice: (state) =>
      state.items.reduce((acc, item) => item.quantity * item.price + acc, 0),
    totalPriceWithShipping(state): number {
      return this.totalPrice + state.shippingPrice;
    },
		getItem: (state) => (id) => state.items.find((item) => item.id === id);
  },
	actions: {
		async loadItems() {
			const result = await fetch("/cart-endpoint");
			this.items = await result.json();
		},
		addItem(item) {
			this.items.push(item);
		},
		removeItem(id) {
			this.items = this.items.filter((item) => item.id !== id);
		},
		async purchaseItems() {
      if (!user.name) return;

      const numOfItems = this.items.length;
      this.items = [];

      return numOfItems;
    }
	},
})
</code></pre>
<!-- TODO -->
<p>Error in IDE Screenshot</p>
					</section>
					<section data-auto-animate="">
						<h2>Composing Stores: Options Store</h2>
						<pre><code data-trim data-line-numbers="30-38">
// stores/useCartStore.[js,ts]
import { defineStore } from "pinia";
	
export const useCartStore = defineStore("Cart", {
	state: () => {
		return {
			items: [],
			shippingPrice: 0,
		}
	},
	getters: {
    totalPrice: (state) =>
      state.items.reduce((acc, item) => item.quantity * item.price + acc, 0),
    totalPriceWithShipping(state): number {
      return this.totalPrice + state.shippingPrice;
    },
		getItem: (state) => (id) => state.items.find((item) => item.id === id);
  },
	actions: {
		async loadItems() {
			const result = await fetch("/cart-endpoint");
			this.items = await result.json();
		},
		addItem(item) {
			this.items.push(item);
		},
		removeItem(id) {
			this.items = this.items.filter((item) => item.id !== id);
		},
		async purchaseItems() {
      const user = useUserStore();
      if (!user.name) return;

      const numOfItems = this.items.length;
      this.items = [];

      return numOfItems;
    }
	},
})
</code></pre>
					</section>
					<section data-auto-animate="">
						<h2>Composing Stores: Setup Store</h2>
						<pre><code data-trim data-line-numbers="26-34,44" class="hljs javascript">
	// stores/useCartStore.[js,ts]
	import { computed, ref } from "vue";
	import { defineStore } from "pinia";
		
	export const useCartStore = defineStore("Cart", () => {
		// state
		const items = ref([]);
		const shippingPrice = ref(0);
	
		// getters
		const totalPrice = computed(() => items.value.reduce((acc, item) => item.quantity * item.price + acc, 0));
		const totalPriceWithShipping = computed(() => totalPrice.value + shippingPrice.value);
		const getItem = (id) => items.value.find((item) => item.id === id)
	
		// actions
		async function loadItems() {
			const result = await fetch("/cart-endpoint");
			this.items = await result.json();
		}
		function addItem(item) {
			items.value.push(item);
		}
		function removeItem(id) {
			items.value = items.value.filter((item) => item.id !== id);
		}
		async function purchaseItems() {
			const user = useUserStore();
      if (!user.name) return;

      const numOfItems = this.items.length;
      this.items = [];

      return numOfItems;
		}
	
		return {
			items,
			totalPrice,
			totalPriceWithShipping,
			getItem,
			loadItems,
			addItem,
			removeItem,
			purchaseItems,
		}
	})
	</code></pre>
					</section>
					<section data-auto-animate="">
						<h2>Composing Stores: Setup Store</h2>
						<pre><code data-trim data-line-numbers="6,28-35,45" class="hljs javascript">
	// stores/useCartStore.[js,ts]
	import { computed, ref } from "vue";
	import { defineStore } from "pinia";
		
	export const useCartStore = defineStore("Cart", () => {
		const user = useUserStore();

		// state
		const items = ref([]);
		const shippingPrice = ref(0);
	
		// getters
		const totalPrice = computed(() => items.value.reduce((acc, item) => item.quantity * item.price + acc, 0));
		const totalPriceWithShipping = computed(() => totalPrice.value + shippingPrice.value);
		const getItem = (id) => items.value.find((item) => item.id === id)
	
		// actions
		async function loadItems() {
			const result = await fetch("/cart-endpoint");
			this.items = await result.json();
		}
		function addItem(item) {
			items.value.push(item);
		}
		function removeItem(id) {
			items.value = items.value.filter((item) => item.id !== id);
		}
		async function purchaseItems() {
      if (!user.name) return;

      const numOfItems = this.items.length;
      this.items = [];

      return numOfItems;
		}
	
		return {
			items,
			totalPrice,
			totalPriceWithShipping,
			getItem,
			loadItems,
			addItem,
			removeItem,
			purchaseItems,
		}
	})
	</code></pre>
					</section>
					<section>
						<h2>Circular dependencies</h2>
						<p>https://pinia.vuejs.org/cookbook/composing-stores.html</p>
					</section>
					<section>
						<!-- TODO: Composing -->
						<h2>Exercise F</h2>
						<ol>
							<li>
								Call stats store action in todo items store
							</li>
						</ol>
					</section>
					<section>
						<h2>Solution E</h2>
						Branchname: <code>F-composing-stores</code>
					</section>
				</section>
				<section data-visibility="hidden">
					<section data-auto-animate="">
						<h2>Migrate from Vuex to Pinia</h2>
					</section>
				</section>
				<section>
					<section>
						<h2>Pinia testing</h2>
					</section>
				</section>
				<section>
					<h2>Migrate from Vuex to Pinia</h2>
				</section>
			</div>
		</div>

		<script src="dist/reveal.js"></script>
		<script src="plugin/notes/notes.js"></script>
		<script src="plugin/markdown/markdown.js"></script>
		<script src="plugin/highlight/highlight.js"></script>
		<script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
				hash: true,
				slideNumber: 'h/v',

				// Learn about plugins: https://revealjs.com/plugins/
				plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
